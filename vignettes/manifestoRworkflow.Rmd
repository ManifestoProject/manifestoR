---
title: "The workflow with the manifestoR package"
author: "Jirka Lewandowski <jirka.lewandowski@wzb.eu>"
date: "27.08.2014"
output: html_document
---

Contents:

- [Working with the corpus](#working-with-the-corpus)
- [Saving and exporting documents](#saving-and-exporting-documents)
- [Working with the CMP codings](#working-with-the-cmp-codings)
- ...

First of all, load the `manifestoR` package:

```
library(manifestor)
```

```{r eval=TRUE, include=FALSE, echo=TRUE}
library(manifestoR)
```
```{r eval=TRUE, include=FALSE}
manifesto.emptycache()
```

## Working with the corpus

This section explains how to ...

- ... connect to the Manifesto Corpus database,
- ... download specific documents and document sets,
- ... access and process documents afterwards.

### How to connect to the Manifesto Corpus database

To access the data in the Manifesto Corpus, an account for the Manifesto Project
webpage with an API key is required.
If you do not yet have an account, you can create one at 
[](https://manifesto-project.wzb.eu/signup).
When you have an account, you can create the API key on your profile page.
For every R session using manifestoR and connecting to the Manifesto Corpus database,
you need to set the API key in your work environment.
This can be done by passing either a key or the name of a file containing the
key to the `manifestodb.setapikey()` function (see documentation for details).
Thus, your R script using manifestoR usually will start like this:

```{r eval=FALSE}
library(manifestoR)
manifestodb.setapikey(key.file = "manifesto_apikey.txt")
```
```{r eval=TRUE, include=FALSE}
manifestodb.setapikey(key.file = "../tests/manifesto_apikey.txt")
```

Note that it is a security risk to store the API key file or a script containing
the key in public repositories.

### How to download documents and document sets

Downloading documents works via the function `manifesto.corpus(...)`.
It takes a `data.frame` listing combinations of party ids and election
dates and returns a `ManifestoCorpus` object, a subtype of the `Corpus` defined
in the package `tm`:

```{r}
wanted <- data.frame(party=c(41320, 41220), date=c(200909, 200909))
corpus <- manifesto.corpus(wanted)
print(corpus)
head(content(corpus[[1]]))
```

Note that we received only 1 document, while querying for two.
This is because the party with the id 41220 (KPD) did not run for elections
in September 2009.
Also, not for every party and election data manifesto documents are availabe in the Manifesto Project Corpus.
You can check availability of your query beforehand with the function
`manifesto.availability(...)`.

The `manifesto.corpus` function also understands several other formats of
input arguments, for details refer to its documentation.
The party ids (41320 in the example) are the ids as in the Manifesto Project's
main dataset.
The party ids can be found in the current dataset documentation at
[](https://manifesto-project.wzb.eu/datasets)
or additionally are used and linked to party names, countries, etc. in
the main dataset, which is also accessible via manifestoR:

Subsets of the main data set can directly be used for querying the corpus
database.

```{r cache=FALSE}
mpds <- manifesto.maindataset()
head(names(mpds)) ## .. and much more
wanted <- subset(mpds,
                 eumember==10 & # see main dataset codebook
                   pervote > 20.0 &
                   edate > as.Date("1990-01-01"))
corpus <- manifesto.corpus(wanted)
print(corpus)
```

Note: downloaded documents are automatically cached locally. To learn about
the caching mechanism read the section
[Understanding manifestoR's caching mechanism](#understanding-manifestors-caching-mechanism)
below.

## Saving and exporting documents

... TODO

## Working with the CMP codings

The central way for accessing the CMP codings is the accessor method `codes(...)`.
It can be called on `ManifestoDocument`s and `ManifestoCorpus`s and returns a vector
of the CMP codings attached to the quasi-sentences of the document/corpus in a row:

```{r}
corpus <- manifesto.corpus(data.frame(party=41320, date=200909))
head(codes(corpus))
head(codes(corpus[[1]]))
head(content(corpus[[1]])[which(codes(corpus[[1]])==503)])
```

## Text scaling methods

... TODO ?

## Working with the additional core data: RILE, election results, ...

... TODO

## Working with the original documents

... TODO (currently not even implemented)

## Understanding manifestoR's caching mechanism

... TODO

## TODO additional

... TODO

### Linking manifestoR to other data and frameworkds

... TODO

### Contributing to manifestoR

... TODO

### Contacting the Manifesto Project team

... TODO


```{r eval=TRUE, include=FALSE}
manifesto.emptycache()
```
